<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendamento</title>
    <link rel="stylesheet" th:href="@{/agendamento/styles.css}">
</head>
<body>
    <header>
        <nav class="nav-bar">
            <a href="/home">Home</a>
            <a href="/agendamento">Agendar Consulta</a>
            <a href="/agenda">Meus Agendamentos</a>
            <a href="/login">Login</a>
        </nav>
    </header>
    <section class="main-section">
        <h1>Marque o dia e o horário para sua Consulta</h1>
        <form id="agendamentoForm">
            <div>
                <h2>Insira a data</h2>
                <input type="date" id="data" required>
            </div>
            <div>
                <h2>Escolha a área de consulta:</h2>
                <select class="form-select" id="selectMenu" onchange="updateAvailableTimes()">
                    <option selected disabled>Selecione a área</option>
                    <option value="1">Medicina</option>
                    <option value="2">Odontologia</option>
                    <option value="3">Psicologia</option>
                </select>
            </div>
            <div id="horarios-disponiveis" style="display:none;">
                <h2>Escolha um horário disponível:</h2>
                <div id="horarios"></div>
            </div>
            <button type="submit">Agendar Consulta</button>
        </form>
    </section>

    <script>
        function updateAvailableTimes() {
            const area = document.getElementById('selectMenu').value;
            const horariosDiv = document.getElementById('horarios');
            const horariosDisponiveisDiv = document.getElementById('horarios-disponiveis');
            
            // Aqui você pode usar uma API para pegar os horários disponíveis de acordo com a área escolhida
            let horarios = [];
            
            if (area === '1') {
                horarios = ['07:00-08:00', '08:00-09:00', '10:00-11:00']; // Exemplo de horários para Medicina
            } else if (area === '2') {
                horarios = ['09:00-10:00', '14:00-15:00', '15:00-16:00']; // Exemplo de horários para Odontologia
            } else if (area === '3') {
                horarios = ['08:00-09:00', '11:00-12:00', '16:00-17:00']; // Exemplo de horários para Psicologia
            }

            // Limpa os horários anteriores
            horariosDiv.innerHTML = '';
            
            // Adiciona os novos horários
            horarios.forEach(horario => {
                const button = document.createElement('button');
                button.type = 'button';
                button.textContent = horario;
                button.classList.add('horario-button');
                horariosDiv.appendChild(button);
            });

            // Exibe a div de horários disponíveis
            horariosDisponiveisDiv.style.display = 'block';
        }
        document.getElementById('agendamentoForm').addEventListener('submit', async function (event) {
        event.preventDefault(); // Impede o envio padrão do formulário

        const data = document.getElementById('data').value;
        const area = document.getElementById('selectMenu').value;

        // Validação simples
        if (!data || !area) {
            alert('Por favor, preencha todos os campos!');
            return;
        }

        // Dados para enviar ao backend
        const agendamento = {
            data,
            area,
        };

        try {
            // Envia os dados para a API (ajuste o URL para o endpoint correto)
            const response = await fetch('/api/agendamentos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(agendamento),
            });

            if (response.ok) {
                const result = await response.json();
                alert('Agendamento salvo com sucesso!');
                console.log(result);
            } else {
                console.error('Erro ao salvar agendamento:', await response.text());
                alert('Erro ao salvar o agendamento. Verifique os logs.');
            }
        } catch (error) {
            console.error('Erro na requisição:', error);
            alert('Erro na conexão com o servidor.');
        }
    });
    </script>
</body>
</html>
